### 2019/11/20

[TOC]

网络的一些知识：

每个TCP socket在内核中都有一个发送缓冲区和一个接收缓冲区，TCP的全双工的工作模式以及TCP的滑动窗口便是依赖于这两个独立的buffer以及此buffer的填充状态。

接收缓冲区把数据缓存入内核，应用进程一直没有调用read进行读取的话，此数据会一直缓存在相应 socket的接收缓冲区内，**不管进程是否读取socket，对端发来的数据都会经由内核接收并且缓存到socket的内核接收缓冲区之中read所做的工作，就是把内核缓冲区中的数据拷贝到应用层用户的buffer里面，仅此而已。**

进程调用send发送的数据的时候，一般情况将数据拷贝进入socket的内核发送缓冲区之中，**然后send便会在上层返回（也就是说send的返回值不能表明数据已经发送到了对端并被接收）**，即换句话说，send返回之时，数据不一定会发送到对端去(和 write写文件有点类似)，send仅仅是把应用层buffer的数据拷贝进socket的内核发送buffer中。

UDP socket都有一个接收缓冲区，没有发送缓冲区。只要有数据就发，不管对方是否可以正确接收，所以不缓冲，不需要发送缓冲区。



如果应用进程一直没有读取，buffer满了之后呢？

通知对端TCP协议中的窗口关闭，个便是滑动窗口的实现，保证TCP套接口接收缓冲区不会溢出，从而保证了TCP是可靠传输，因为对方不允许发出超过所通告窗口大小的数据。 这就是TCP的流量控制，如果对方无视窗口大小而发出了超过窗口大小的数据，则接收方TCP将丢弃它



