## 20200929

[TOC]

### 监控反模式

1. 事后监控

   有一种常见的反模式，将监控和其它运维工作（比如安全性）视为应用程序的增值组件而非核心功能。与安全性一样，监控也应该是应用程序的核心功能。在为应用程序规划用户故事的时候，务必要先把应用程序每个组件的监控指标考虑进来。

2. 机械式监控

   比如，只考虑每台主机上面的CPU、内存和磁盘。但不监控主机上应用程序是否正常的关键服务，或很少关注这些关键服务。应该根据服务价值设计自上而下的监控系统，这会帮助明确应用程序中更有价值的部分，并优先监控这些内容。即从业务逻辑和业务输出开始，向下到应用程序逻辑，最后到基础设施。

3. 不够准确的监控

   监控了主机上的服务状态，但不够准确。例如，通过检查HTTP 200状态吗可以监控是否在运行，但不会反应出是否返回了正确的数据。

4. 静态监控

   另一种反模式是使用静态阈值。静态阈值几乎总是错误的。

5. 不频繁的监控

   一般默认设置一个较大的值，比如每隔5~15分钟检查一次应用程序。这通常导致检查之间发生关键事件丢失。你应该频繁的监控应用程序。

6. 缺少自动化或自助服务

   监控系统很差或者不好部署实施。应该使监控系统的实施和部署自动化。主机和服务的配置应该通过自动发现或自助提交进行；添加检查应该很简单；数据和可视化应该是自服务的。



### 指标

指标是软件或硬件组件属性的度量。为了使指标有价值，我们会跟踪其状态，通常记录一段时间内的数据点。

数据点被称为**观察点**，通常包括值、时间戳、描述观察点的一系列属性（如源或标签）

观察的集称为**时间序列**

固定的时间间隔收集数据，该时间间隔被称为**颗粒度**



**指标的类型**：测量型、计数型、直方图

测量型：这种类型是上下增减的数字，本质上是特定度量的快照。gauge

计数型：这种类型是随着时间增加而不会减少的数字。counter

直方图：是对观察点进行采样的指标类型。将数据分组在一起。histogram



**指标摘要**

对指标应用一些数学变换。常见函数有

* 计数：特定时间间隔内的观察点数
* 求和：特定时间间隔内所有观察点的**值的累计**
* 平均值：特定时间间隔内所有观察点的**值的平均值**
* 中间数：数值的几何中点。
* 百分位数：？*Quantile*
* 标准差：显示指标分布中与平均值的标准差，可以测量数据集的差异程度。
* 变化率：时间序列中数据之间的变化程度



### 监控方法论

USE 侧重于主机级监控

Google的四个黄金指标：延迟、流量、错误、饱和度。



### 警报和通知

警报会在某些事件发生时触发。

通知接受告警并告知某人或某事。

出色的通知系统：

1. 哪些问题需要通知
2. 谁需要被告知
3. 如何告知
4. 多久告知
5. 何时停止告知以及何时升级到其它人

如果配置不当，就会生成过多的通知。（过多的通知，常常带来的问题就是，全选，删掉）

通知的内容也非常重要。

1. 使通知清晰、准确、可操作性
2. 为通知添加上下文
3. 仅发送有意义的通知



